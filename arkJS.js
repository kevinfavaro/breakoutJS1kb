z=()=>{m=[...Array(9)].map((x,y)=>x=[...Array(9)].map((j,i)=>(y>1&y<5&i>1&i<7?"c":" ")));x=y=5;o=u=0;v=w=1;_=4;};z();p=1;n=-1;bc=(l,t,r,d)=>{v*=(l&v==n)|(r&v==p)?-1:1;w*=(t&w==n)|(d&w==p)?-1:1;return l|t|r|d};k=(l,t)=>m[y+((y>0&t==-1)|(y<8&t==1)?t:0)][x+((x>0&l==-1)|(x<8&l==1)?l:0)]=='c'&((v==l)|(w==t));c=(l,d)=>w==d&v==l&k(l,d);kd=()=>c(-1,-1)|c(1,-1)|c(-1,1)|c(1,1);dc=()=>{m[8].map((x,i)=>m[8][i]=(i>_-2&i<_+2?'_':' '));m[u][o]=' ';m[y<0?0:y][x<0?0:x]='o';};tc=()=>{if(y>7)return z();a=bc(x<1,y<1,x>7,0);if(y==7&w==1)a=bc(x==_+2,0,x==_-2,x>_-3&x<_+3);bx=x+v;by=y+w;bl=k(-1,0)|k(1,0);bt=k(0,-1)|k(0,1);a=bc(k(-1,0),k(0,-1),k(1,0),k(0,1));b=0;if(!a&kd()){bl=bt=1;b=bc(c(-1,-1)|c(-1,1),c(-1,-1)|c(1,-1),c(1,-1)|c(1,1),c(-1,1)|c(1,1));}if(a|b)m[(bt&!bl)|(b&bt)?by:y][bl?bx:x]=' ';return a|b};r=()=>{dc();o=x;u=y;while(tc());x=x+v;y=y+w;dc();dr()};document.addEventListener('keydown',e=>{q=e.keyCode;if(q==37){_-=(_>1?1:0)};if(q==39){_+=(_<7?1:0)}});setInterval(r,400);